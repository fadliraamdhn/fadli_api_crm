generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ROLE {
  Sales
  Manager
}

enum LEAD_STATUS {
  New
  Converted
  Closed
}

enum PROJECT_STATUS {
  approval
  approved
  rejected
}

model User {
  id        Int        @id @default(autoincrement())
  username  String     @unique
  password  String
  role      ROLE
  leads     Lead[]
  customers Customer[]
  projects  Project[]
  createdAt DateTime   @default(now())
}

model Lead {
  id        Int         @id @default(autoincrement())
  name      String
  contact   String
  address   String
  need      String
  status    LEAD_STATUS @default(New)
  salesId   Int
  sales     User        @relation(fields: [salesId], references: [id])
  projects  Project[]
  createdAt DateTime    @default(now())
}

model Product {
  id           Int               @id @default(autoincrement())
  name         String
  hpp          Int
  marginSales  Int
  sellingPrice Int
  dealProducts DealProduct[]
  createdAt    DateTime          @default(now())

  productBuy CustomerService[]
}

model Project {
  id         Int             @id @default(autoincrement())
  leadId     Int            
  lead       Lead           @relation(fields: [leadId], references: [id])
  salesId    Int
  sales      User            @relation(fields: [salesId], references: [id])
  status     PROJECT_STATUS  @default(approval)
  createdAt  DateTime        @default(now())
  products   DealProduct[]

  projectComplete CustomerService[]
}

model DealProduct {
  id              Int     @id @default(autoincrement())
  projectId       Int
  project         Project @relation(fields: [projectId], references: [id])
  productId       Int
  product         Product @relation(fields: [productId], references: [id])
  negotiatedPrice Int
}

model Customer {
  id      Int      @id @default(autoincrement())
  name    String
  contact String
  address String
  salesId Int
  sales   User     @relation(fields: [salesId], references: [id])
  createdAt DateTime @default(now())

  customerService CustomerService[]
}

model CustomerService {
  id         Int      @id @default(autoincrement())
  customerId Int
  productId  Int
  projectId  Int
  createdAt  DateTime @default(now())

  customer Customer @relation(fields: [customerId], references: [id])
  product  Product  @relation(fields: [productId], references: [id])
  project  Project  @relation(fields: [projectId], references: [id])
}